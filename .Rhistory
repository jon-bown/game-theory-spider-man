player_salary_data <- player_salary_data[!duplicated(player_salary_data$Player),]
players_tot <- player_data_raw[which(player_data_raw$Tm == "TOT"),"Player"]
player_data_clean <- player_data_raw[which(!(player_data_raw$Player %in% players_tot)),]
player_data_ws_clean <- player_ws_data_raw[which(!(player_data_raw$Player %in% players_tot)),]
player_rpmw_data_raw$Player  <- lapply(player_rpmw_data_raw$NAME, function(x) {sub("\\,.*","",x)})
for(player in players_tot){
raw_data1 <- player_data_raw[which(player_data_raw$Player == player), ]
raw_data2 <- player_ws_data_raw[which(player_ws_data_raw$Player == player), ]
player_data_clean <- rbind(player_data_clean, raw_data1[3,])
player_data_ws_clean <- rbind(player_data_ws_clean, raw_data2[3,])
}
#Calculate win score
cols <- c("Team", "CPW")
df <-  team_cost_data[order(-team_cost_data$CPW),cols]
df$CPW <- dollar(df$CPW)
kable(x=df, align=c('l','c'), row.names = FALSE, col.names = c('Player', 'Win Value'), caption="Win Value")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12)
team_cost_data$CPW <- rep(2949908.82, length(team_cost_data[,1]))
#Step One:
player_data_tm <- join(player_data_clean, team_key, by = "Tm")
player_data_tm <- join(player_data_tm, opp_data, by = "Team")
player_data_tm <- join(player_data_tm, team_data, by = "Team")
player_data_tm$OppFTM <- player_data_tm$PF/player_data_tm$TPF*player_data_tm$OFT
player_data_tm$PROD <- with(player_data_tm, X3P*0.064 + X2P*0.032 + FT*0.017 + (FGA-FG)*-0.034 + (FTA - FT)*-0.015 + ORB*0.034 + DRB*0.034 + TOV*-0.034 + STL*0.033 + OppFTM*-0.017 + BLK*0.020)
player_data_tm$P48 <- (player_data_tm$PROD/player_data_tm$MP)*48
#Step two:
#1
player_data_tm$TDRBPM <- with(player_data_tm, (TDRB-DRB)/(TMP-MP))
#2
player_data_tm$DRBL <- player_data_tm$TDRBPM*(-0.504)
#3
player_data_tm$VDRB <- player_data_tm$DRBL*(0.034)*player_data_tm$MP
#4
by_team1 <- aggregate(player_data_tm$VDRB, by=list(player_data_tm$Tm), FUN=sum)
colnames(by_team1) <- c("Tm", "Sum1")
player_data_tm <- join(player_data_tm, by_team1, by = "Tm")
#5
player_data_tm$VDRBI <- player_data_tm$Sum1*(player_data_tm$DRB/player_data_tm$TDRB)
player_data_tm$PROD_DREBADJ <- (((player_data_tm$Sum1 - player_data_tm$VDRBI) + player_data_tm$PROD)/player_data_tm$MP)*48
#Step four: Incorporate team defense and calculate adjusted P48
player_data_tm$TDA <- with(player_data_tm, ((O3P*-0.064 + O2P*-0.031+OTOV*0.033+TTOV*-0.034+TRB*0.033-TBLK*-0.02)/TMP)*48)
player_data_tm$adjp48 <- player_data_tm$P48+ (mean(player_data_tm$TDA, by=list(player_data_tm$Tm), FUN=mean) - player_data_tm$TDA)
#Skip to step 6
player_data_tm$relAdjP48 <- player_data_tm$adjp48 - mean(player_data_tm$adjp48, by=list(player_data_tm$Tm), FUN=mean)
player_data_tm$WP48 <- player_data_tm$relAdjP48 + 0.099
player_data_tm$WP <- round(player_data_tm$WP48/48*player_data_tm$MP, 4)
#sum(player_data_tm[which(player_data_tm$Tm == "UTA"),"WP"])
#player_data_tm[,c("Player", "WP")]
#create data frame of focused players. Output win share, win score, and wins produced.
cols <- c("Player", "WP")
df <-  na.omit(player_data_tm[order(-player_data_tm$WP),cols])
df <- df[1:20,]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
cols <- c("Player", "WP")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'WP'), caption="\\label{wa_corr}Wins Produced Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
cols <- c("Player", "WINS")
df <-  player_rpmw_data_raw[order(-player_rpmw_data_raw$WINS),cols]
df <- df[1:20,]
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'RPM Wins'), caption="\\label{wa_corr}RPM Wins Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
player_data_tm <- join(player_data_tm, team_cost_data, by="Tm")
player_data_tm <- join(player_data_tm, player_data_ws_clean, by="Player")
player_data_tm$WPS <-  player_data_tm$WINS/player_data_tm$W
View(player_data_tm)
cols <- c("Player", "WINS")
df <-  player_rpmw_data_raw[order(-player_rpmw_data_raw$WINS),cols]
df <- df[1:20,]
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'RPM Wins'), caption="\\label{wa_corr}RPM Wins Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
player_data_tm <- join(player_data_tm, team_cost_data, by="Tm")
player_data_tm <- join(player_data_tm, player_data_ws_clean, by="Player")
player_data_tm$WPS <-  player_data_tm$WINS/player_data_tm$W
View(player_rpmw_data_raw)
View(player_data_tm)
View(player_rpmw_data_raw)
View(team_cost_data)
player_rpm_win_data <- join(player_rpmw_data_raw, team_cost_data, by="Tm")
player_rpm_win_data <- join(player_rpmw_data_raw, team_cost_data, by=c("Tm" = "TEAM"))
player_rpm_win_data <- join(player_rpmw_data_raw, team_cost_data, by=c("Tm" = "TEAM"))
player_rpm_win_data <- join(player_rpmw_data_raw, team_cost_data, by=c("Tm" = "TEAM"))
player_rpm_win_data <- join(player_rpmw_data_raw, team_cost_data, by=c("TEAM" = "Tm"))
player_rpm_win_data <- player_rpmw_data_raw %>% left_join(team_cost_data, by=c("TEAM" = "Tm"))
player_rpm_win_data$RPMWS <-  player_data_tm$WINS/player_data_tm$W*82
View(player_rpm_win_data)
player_rpm_win_data <- player_rpmw_data_raw %>% inner_join(team_cost_data, by=c("TEAM" = "Tm"))
player_rpm_win_data$RPMWS <-  player_data_tm$WINS/player_data_tm$W*82
View(player_rpm_win_data)
player_rpm_win_data <- player_rpmw_data_raw %>% inner_join(team_cost_data, by=c("TEAM" = "Tm"))
player_rpm_win_data$RPMWS <-  player_rpm_win_data$WINS/player_rpm_win_data$W*82
cols <- c("Player", "RPMWS")
df <-  player_rpm_win_data[order(-player_data_tm$RPMWS),cols]
cols <- c("Player", "RPMWS")
df <-  player_rpm_win_data[order(-player_rpm_win_data$RPMWS),cols]
df <- df[1:20,]
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'RPM Win Share'), caption="\\label{wa_corr}RPM Win Share Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
player_rpm_win_data <- player_rpmw_data_raw %>% inner_join(team_cost_data, by=c("TEAM" = "Tm"))
player_rpm_win_data$RPMWS <-  round(player_rpm_win_data$WINS/player_rpm_win_data$W*82,digits=2)
cols <- c("Player", "RPMWS")
df <-  player_rpm_win_data[order(-player_rpm_win_data$RPMWS),cols]
df <- df[1:20,]
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'RPM Win Share'), caption="\\label{wa_corr}RPM Win Share Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
#Add column for surplus ws, surplus wp
player_data_tm$Player <- unlist(lapply(player_data_tm$Player, function(x) {sub("\\,.*","",x)}))
player_data_slry <- join(player_salary_data[,c('Player', 'X2018.19', 'Tm')], player_data_tm, by = "Player")
player_data_slry$Player <- unlist(lapply(player_data_slry$Player, function(x) {sub("\\\\.*","",x)}))
player_data_slry <- join(player_data_slry, player_rpmw_data_raw, by = "Player")
player_data_slry$MRP <-  player_data_slry$WINS*player_data_slry$CPW
player_data_jzz <- player_data_slry[which(player_data_slry$Tm == 'UTA'),]
cols <- c("Player", "MRP", "X2018.19", "MRP")
df <-  player_data_jzz[order(-player_data_jzz$MRP),cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="Utah Jazz Player NOV RPM")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
#sum(player_data_tm[which(player_data_tm$Tm == "CLE"),"WS"])
wo <- sum(df$diff1)-df[which(df$Player == "Kyle Korver"), 'diff1']+ df[which(df$Player == "Grayson Allen"), 'diff1'] + df[which(df$Player == "Jae Crowder"), 'diff1']
player_data_co <- player_data_slry[which(player_data_slry$Player == 'Mike Conley'),]
player_data_co$after <-  player_data_co$WINS*player_data_co[1,'CPW']
cols <- c("Player", "MRP", "X2018.19", "after")
df <-  player_data_co[,cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$after)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV" ), caption="")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
w <- wo+df$diff1
#Add column for surplus ws, surplus wp
player_data_tm$Player <- unlist(lapply(player_data_tm$Player, function(x) {sub("\\,.*","",x)}))
player_data_slry <- join(player_salary_data[,c('Player', 'X2018.19', 'Tm')], player_data_tm, by = "Player")
player_data_slry$Player <- unlist(lapply(player_data_slry$Player, function(x) {sub("\\\\.*","",x)}))
player_data_slry <- join(player_data_slry, player_rpmw_data_raw, by = "Player")
player_data_slry$MRP <-  player_data_slry$WINS*player_data_slry$CPW
player_data_jzz <- player_data_slry[which(player_data_slry$Tm == 'UTA'),]
cols <- c("Player", "MRP", "X2018.19", "MRP")
df <-  player_data_jzz[order(-player_data_jzz$MRP),cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="Utah Jazz Player NOV RPM")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
#sum(player_data_tm[which(player_data_tm$Tm == "CLE"),"WS"])
wo <- sum(df$diff1)-df[which(df$Player == "Kyle Korver"), 'diff1']+ df[which(df$Player == "Grayson Allen"), 'diff1'] + df[which(df$Player == "Jae Crowder"), 'diff1']
player_data_co <- player_data_slry[which(player_data_slry$Player == 'Mike Conley'),]
player_data_co$after <-  player_data_co$WINS*player_data_co[1,'CPW']
cols <- c("Player", "MRP", "X2018.19", "after")
df <-  player_data_co[,cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$after)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV" ), caption="")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
w <- wo+df$diff1
#Add column for surplus ws, surplus wp
player_data_tm$Player <- unlist(lapply(player_data_tm$Player, function(x) {sub("\\,.*","",x)}))
player_data_slry <- join(player_salary_data[,c('Player', 'X2018.19', 'Tm')], player_data_tm, by = "Player")
player_data_slry$Player <- unlist(lapply(player_data_slry$Player, function(x) {sub("\\\\.*","",x)}))
player_data_slry <- join(player_data_slry, player_rpmw_data_raw, by = "Player")
player_data_slry$MRP <-  player_data_slry$WINS*player_data_slry$CPW
player_data_jzz <- player_data_slry[which(player_data_slry$Tm == 'UTA'),]
player_data_n1 <- player_data_slry[which(player_data_slry$Player == 'Bojan Bogdanovic'),]
player_data_n2 <- player_data_slry[which(player_data_slry$Player == 'Ed Davis'),]
player_data_n3 <- player_data_slry[which(player_data_slry$Player == 'Mike Conley'),]
player_data_n4 <- player_data_slry[which(player_data_slry$Player == 'Jeff Green'),]
player_data_n5 <- player_data_slry[which(player_data_slry$Player == 'Emmanuel Mudiay'),]
player_data_jzz <- player_data_jzz[which(player_data_jzz$Player != "Kyle Korver" & player_data_jzz$Player != "Grayson Allen" & player_data_jzz$Player != "Jae Crowder"& player_data_jzz$Player != "Derrick Favors" & player_data_jzz$Player != "Ricky Rubio"),]
player_data_jzz <- rbind(player_data_jzz,player_data_n1,player_data_n2,player_data_n3, player_data_n4, player_data_n5)
cols <- c("Player", "MRP", "X2018.19", "MRP")
df <-  player_data_jzz[order(-player_data_jzz$MRP),cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
produce <- sum(df$MRP)
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
cost <- sum(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="\\label{wa_corr}Utah Jazz Roster July 2019")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
#sum(player_data_tm[which(player_data_tm$Tm == "CLE"),"WS"])
wo <- sum(df$diff1)
profit <- produce - cost
#Add column for surplus ws, surplus wp
player_data_tm$Player <- unlist(lapply(player_data_tm$Player, function(x) {sub("\\,.*","",x)}))
player_data_slry <- join(player_salary_data[,c('Player', 'X2018.19', 'Tm')], player_data_tm, by = "Player")
player_data_slry$Player <- unlist(lapply(player_data_slry$Player, function(x) {sub("\\\\.*","",x)}))
player_data_slry <- join(player_data_slry, player_rpmw_data_raw, by = "Player")
player_data_slry$MRP <-  (player_data_slry$WINS/player_data_slry$W*82)*player_data_slry$CPW
player_data_jzz <- player_data_slry[which(player_data_slry$Tm == 'UTA'),]
cols <- c("Player", "MRP", "X2018.19", "MRP")
df <-  player_data_jzz[order(-player_data_jzz$MRP),cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="Utah Jazz Player NOV RPM")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
#sum(player_data_tm[which(player_data_tm$Tm == "CLE"),"WS"])
wo <- sum(df$diff1)-df[which(df$Player == "Kyle Korver"), 'diff1']+ df[which(df$Player == "Grayson Allen"), 'diff1'] + df[which(df$Player == "Jae Crowder"), 'diff1']
player_data_co <- player_data_slry[which(player_data_slry$Player == 'Mike Conley'),]
player_data_co$after <-  player_data_co$WINS/player_data_co$W*82*player_data_co[1,'CPW']
cols <- c("Player", "MRP", "X2018.19", "after")
df <-  player_data_co[,cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$after)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV" ), caption="")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
w <- wo+df$diff1
#Add column for surplus ws, surplus wp
player_data_tm$Player <- unlist(lapply(player_data_tm$Player, function(x) {sub("\\,.*","",x)}))
player_data_slry <- join(player_salary_data[,c('Player', 'X2018.19', 'Tm')], player_data_tm, by = "Player")
player_data_slry$Player <- unlist(lapply(player_data_slry$Player, function(x) {sub("\\\\.*","",x)}))
player_data_slry <- join(player_data_slry, player_rpmw_data_raw, by = "Player")
player_data_slry$MRP <-  (player_data_slry$WINS/player_data_slry$W*82)*player_data_slry$CPW
player_data_jzz <- player_data_slry[which(player_data_slry$Tm == 'UTA'),]
player_data_n1 <- player_data_slry[which(player_data_slry$Player == 'Bojan Bogdanovic'),]
player_data_n2 <- player_data_slry[which(player_data_slry$Player == 'Ed Davis'),]
player_data_n3 <- player_data_slry[which(player_data_slry$Player == 'Mike Conley'),]
player_data_n4 <- player_data_slry[which(player_data_slry$Player == 'Jeff Green'),]
player_data_n5 <- player_data_slry[which(player_data_slry$Player == 'Emmanuel Mudiay'),]
player_data_jzz <- player_data_jzz[which(player_data_jzz$Player != "Kyle Korver" & player_data_jzz$Player != "Grayson Allen" & player_data_jzz$Player != "Jae Crowder"& player_data_jzz$Player != "Derrick Favors" & player_data_jzz$Player != "Ricky Rubio"),]
player_data_jzz <- rbind(player_data_jzz,player_data_n1,player_data_n2,player_data_n3, player_data_n4, player_data_n5)
cols <- c("Player", "MRP", "X2018.19", "MRP")
df <-  player_data_jzz[order(-player_data_jzz$MRP),cols]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
produce <- sum(df$MRP)
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
cost <- sum(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff1 <- as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff1")
df <-  df[order(-df$diff1),cols]
df$diff2 <- dollar(df$diff1)
cols <- c("Player", "MRP", "Salary", "diff2")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="\\label{wa_corr}Utah Jazz Roster July 2019")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
#sum(player_data_tm[which(player_data_tm$Tm == "CLE"),"WS"])
wo <- sum(df$diff1)
profit <- produce - cost
cols <- c("Player", "MRP", "X2018.19")
df <-  na.omit(player_data_slry[order(-player_data_slry$MRP),cols])
df2 <-  na.omit(player_data_slry[order(-player_data_slry$MRP),cols])
df <- df[1:20,]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff <- dollar(as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary)))
df2 <- df2[1:20,]
df2$Player <- lapply(df2$Player, function(x) {sub("\\\\.*","",x)})
df2$MRP_D <- dollar(df2$MRP)
df2$Salary <- lapply(df2$X2018.19, function(x) {sub("\\$","",x)})
df2$Salary <- as.numeric(df2$Salary)
df2$Salary <- dollar(df2$Salary)
df2$diff <- dollar(as.numeric(gsub('[$,]', '', df2$MRP)) - as.numeric(gsub('[$,]', '', df2$Salary)))
cols <- c("Player", "MRP_D", "Salary", "diff")
kable(x=df2[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="\\label{wa_corr}MRP Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = TRUE,font_size = 12, bootstrap_options = c("striped", "hover"))
cols <- c("Player", "MRP", "X2018.19")
df <-  na.omit(player_data_slry[order(player_data_slry$MRP),cols])
df <- df[1:20,]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff <- dollar(as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary)))
cols <- c("Player", "MRP", "Salary", "diff")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="\\label{wa_corr}MRP Bottom 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
cols <- c("Player", "MRP", "X2018.19")
df <-  na.omit(player_data_slry[order(-player_data_slry$MRP),cols])
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
df$MRP <- dollar(df$MRP)
df$Salary <- lapply(df$X2018.19, function(x) {sub("\\$","",x)})
df$Salary <- as.numeric(df$Salary)
df$Salary <- dollar(df$Salary)
df$diff <- dollar(as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary)))
df$diff <- as.numeric(gsub('[$,]', '', df$MRP)) - as.numeric(gsub('[$,]', '', df$Salary))
cols <- c("Player", "MRP", "Salary", "diff")
df <- df[order(df$diff),cols]
df$diff <- dollar(df$diff)
cols <- c("Player", "MRP", "Salary", "diff")
kable(x=df[1:20,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'MRP', 'Salary', "NOV"), caption="\\label{wa_corr}Most Overvalued Players")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
knitr::opts_chunk$set(echo = FALSE)
library(plyr)
library(dplyr)
library(ggplot2)
#library(lubridate)
library(xts)
library(knitr)
library(xtable)
library(kableExtra)
library(here)
library(stargazer)
library(readxl)
library(scales)
player_data_raw <- read.csv(here('Player_data.txt'), stringsAsFactors=FALSE, header=TRUE)
team_data <- read.csv(here('Team_data.txt'), stringsAsFactors=FALSE, header=TRUE)
team_key <- read.csv(here('Team_abbrev.txt'), stringsAsFactors=FALSE, header=TRUE)
team_cost_data <- read.csv(here('Team_win_cost.txt'), stringsAsFactors=FALSE, header=TRUE)
player_salary_data <- read.csv(here('Player_sal_data.txt'), stringsAsFactors=FALSE, header=TRUE)
opp_data <- read.csv(here('Opp_data.txt'), stringsAsFactors=FALSE, header=TRUE)
player_ws_data_raw <- read.csv(here('Player_ws_data.txt'), stringsAsFactors=FALSE, header=TRUE)
player_rpmw_data_raw <- read.csv(here('player_rpm_w.csv'), stringsAsFactors=FALSE, header=TRUE)
player_salary_data <- player_salary_data[!duplicated(player_salary_data$Player),]
players_tot <- player_data_raw[which(player_data_raw$Tm == "TOT"),"Player"]
player_data_clean <- player_data_raw[which(!(player_data_raw$Player %in% players_tot)),]
player_data_ws_clean <- player_ws_data_raw[which(!(player_data_raw$Player %in% players_tot)),]
player_rpmw_data_raw$Player  <- lapply(player_rpmw_data_raw$NAME, function(x) {sub("\\,.*","",x)})
for(player in players_tot){
raw_data1 <- player_data_raw[which(player_data_raw$Player == player), ]
raw_data2 <- player_ws_data_raw[which(player_ws_data_raw$Player == player), ]
player_data_clean <- rbind(player_data_clean, raw_data1[3,])
player_data_ws_clean <- rbind(player_data_ws_clean, raw_data2[3,])
}
#Calculate win score
cols <- c("Team", "CPW")
df <-  team_cost_data[order(-team_cost_data$CPW),cols]
df$CPW <- dollar(df$CPW)
kable(x=df, align=c('l','c'), row.names = FALSE, col.names = c('Player', 'Win Value'), caption="Win Value")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12)
team_cost_data$CPW <- rep(2949908.82, length(team_cost_data[,1]))
#Step One:
player_data_tm <- join(player_data_clean, team_key, by = "Tm")
player_data_tm <- join(player_data_tm, opp_data, by = "Team")
player_data_tm <- join(player_data_tm, team_data, by = "Team")
player_data_tm$OppFTM <- player_data_tm$PF/player_data_tm$TPF*player_data_tm$OFT
player_data_tm$PROD <- with(player_data_tm, X3P*0.064 + X2P*0.032 + FT*0.017 + (FGA-FG)*-0.034 + (FTA - FT)*-0.015 + ORB*0.034 + DRB*0.034 + TOV*-0.034 + STL*0.033 + OppFTM*-0.017 + BLK*0.020)
player_data_tm$P48 <- (player_data_tm$PROD/player_data_tm$MP)*48
#Step two:
#1
player_data_tm$TDRBPM <- with(player_data_tm, (TDRB-DRB)/(TMP-MP))
#2
player_data_tm$DRBL <- player_data_tm$TDRBPM*(-0.504)
#3
player_data_tm$VDRB <- player_data_tm$DRBL*(0.034)*player_data_tm$MP
#4
by_team1 <- aggregate(player_data_tm$VDRB, by=list(player_data_tm$Tm), FUN=sum)
colnames(by_team1) <- c("Tm", "Sum1")
player_data_tm <- join(player_data_tm, by_team1, by = "Tm")
#5
player_data_tm$VDRBI <- player_data_tm$Sum1*(player_data_tm$DRB/player_data_tm$TDRB)
player_data_tm$PROD_DREBADJ <- (((player_data_tm$Sum1 - player_data_tm$VDRBI) + player_data_tm$PROD)/player_data_tm$MP)*48
#Step Three: Adjust for Assists
#1
TAPM <- with(player_data_tm, (TAST - AST)/(TMP-MP))
#2
TAPM2 <- TAPM*0.725
#3
TAPM3 <- TAPM2*2
#4
TAPM4 <- TAPM3*player_data_tm$FGA
#5
player_data_tm$TAPM5 <- TAPM4*0.032586
by_team1 <- aggregate(player_data_tm$TAPM5, by=list(player_data_tm$Tm), FUN=sum)
colnames(by_team1) <- c("Tm", "ASTSum1")
#6
player_data_tm <- join(player_data_tm, by_team1, by = "Tm")
#fin
player_data_tm$AST_FIN <- player_data_tm$ASTSum1*(player_data_tm$AST/player_data_tm$TAST)
#Step four: Incorporate team defense and calculate adjusted P48
player_data_tm$TDA <- with(player_data_tm, ((O3P*-0.064 + O2P*-0.031+OTOV*0.033+TTOV*-0.034+TRB*0.033-TBLK*-0.02)/TMP)*48)
player_data_tm$adjp48 <- player_data_tm$P48+ (mean(player_data_tm$TDA, by=list(player_data_tm$Tm), FUN=mean) - player_data_tm$TDA)
#Skip to step 6
player_data_tm$relAdjP48 <- player_data_tm$adjp48 - mean(player_data_tm$adjp48, by=list(player_data_tm$Tm), FUN=mean)
player_data_tm$WP48 <- player_data_tm$relAdjP48 + 0.099
player_data_tm$WP <- round(player_data_tm$WP48/48*player_data_tm$MP, 4)
#sum(player_data_tm[which(player_data_tm$Tm == "UTA"),"WP"])
#player_data_tm[,c("Player", "WP")]
#create data frame of focused players. Output win share, win score, and wins produced.
cols <- c("Player", "WP")
df <-  na.omit(player_data_tm[order(-player_data_tm$WP),cols])
df <- df[1:20,]
df$Player <- lapply(df$Player, function(x) {sub("\\\\.*","",x)})
cols <- c("Player", "WP")
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'WP'), caption="\\label{wa_corr}Wins Produced Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
cols <- c("Player", "WINS")
df <-  player_rpmw_data_raw[order(-player_rpmw_data_raw$WINS),cols]
df <- df[1:20,]
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'RPM Wins'), caption="\\label{wa_corr}RPM Wins Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
player_rpm_win_data <- player_rpmw_data_raw %>% inner_join(team_cost_data, by=c("TEAM" = "Tm"))
player_rpm_win_data$RPMWS <-  round(player_rpm_win_data$WINS/player_rpm_win_data$W*82,digits=2)
cols <- c("Player", "RPMWS")
df <-  player_rpm_win_data[order(-player_rpm_win_data$RPMWS),cols]
df <- df[1:20,]
kable(x=df[,cols], align=c('l','c'), row.names = FALSE, col.names = c('Player', 'RPM Win Share'), caption="\\label{wa_corr}RPM Win Share Top 20")  %>%
kable_styling(latex_options = c("striped","hold_position"),
full_width = FALSE,font_size = 12, bootstrap_options = c("striped", "hover"))
#Add column for surplus ws, surplus wp
player_data_tm$Player <- unlist(lapply(player_data_tm$Player, function(x) {sub("\\,.*","",x)}))
player_data_slry <- join(player_salary_data[,c('Player', 'X2018.19', 'Tm')], player_data_tm, by = "Player")
player_data_slry$Player <- unlist(lapply(player_data_slry$Player, function(x) {sub("\\\\.*","",x)}))
player_data_slry <- join(player_data_slry, player_rpmw_data_raw, by = "Player")
player_data_slry$MRP <-  player_data_slry$WINS*player_data_slry$CPW
player_data_slry <- join(player_data_slry, player_rpmw_data_raw, by = "Player")
View(player_data_slry)
View(player_data_tm)
View(player_data_slry)
install.packages('dollar')
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(ggplot2)
#library(lubridate)
library(xts)
library(knitr)
library(xtable)
library(kableExtra)
library(here)
library(stargazer)
library(readxl)
library(scales)
far_from_total <- 1111407071
far_from_cost <- 160000000
sony_dist <- 66677508
sony_lic <- 126500000+158000000 - 25000000
marvel_merch <- 1300000000
venom_total <- 856085151
venom_cost <- 100000000
venom_dist <- 52000000
venom_lic <- 100000000+100000000 - 25000000
merch_fee <- 35000000
feige_cost <- 2150000
#matrix numbers
a11 <- 0.7*far_from_total - 0.7*far_from_cost
a12 <- 0.5*far_from_total - 0.5*far_from_cost
a21 <- 0.95*far_from_total - far_from_cost
a22 <- venom_total - venom_cost
#Disney
b11 <- 0.3*far_from_total - 0.3*far_from_cost
b12 <- 0.5*far_from_total - 0.5*far_from_cost
b21 <- 0.05*far_from_total -3*feige_cost
b22 <- 0
a22-a12
a11-a12-a21+a22
a22-a21
